!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(window,(function(t){return function(t){var i={};function s(h){if(i[h])return i[h].exports;var n=i[h]={i:h,l:!1,exports:{}};return t[h].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)s.d(h,n,function(i){return t[i]}.bind(null,n));return h},s.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=1)}([function(i,s){i.exports=t},function(t,i,s){"use strict";s.r(i),s.d(i,"CharacterController",(function(){return n})),s.d(i,"ActionData",(function(){return u})),s.d(i,"ActionMap",(function(){return r})),s.d(i,"CCSettings",(function(){return f}));var h=s(0),n=function(){function t(t,i,s,n,u){var f=this;void 0===u&&(u=!1),this.u=null,this.v=null,this.k=9.8,this.M=30,this.j=45,this.O=Math.PI*this.M/180,this.g=Math.PI*this.j/180,this.C=.25,this.F=0,this.A=h.Vector3.Zero(),this.L=new r,this.R=!0,this.S=h.Vector3.Zero(),this.q=!1,this.B=0,this.I=0,this.J=!1,this._=-1,this.D=!1,this.T=!1,this.G=null,this.H=h.Vector3.Zero(),this.K=!1,this.N=0,this.P=50,this.U=0,this.V=!1,this.W=!1,this.X=!1,this.Y=700,this.Z=null,this.$=new h.AnimationEvent(0,(function(){null!=f.tt.sound&&f.tt.sound.play()})),this.it=0,this.st=0,this.ht=0,this.nt=1,this.et=!1,this.ut=!1,this.rt=0,this.ft=0,this.ot=10,this.ct=!0,this.lt=!1,this.vt=new h.Ray(h.Vector3.Zero(),h.Vector3.One(),1),this.bt=h.Vector3.Zero(),this.wt=.5,this.kt=new Array,this.dt=!1,this.Mt=50,this.pt=!1,this.jt=!1,this.yt=!1,this.Ot=i,this.gt=s,this.setAvatar(t,u)||console.error("unable to set avatar");null!=n&&this.setActionMap(n),this.jt||null==this.v||this.xt(this.v),this.jt,this.ct=this.Ot.checkCollisions,this.Ct=new e,this.Ft=function(){f.At()},this.Lt=function(t){f.Rt(t)},this.St=function(t){f.qt(t)}}return t.prototype.getScene=function(){return this.gt},t.prototype.setSlopeLimit=function(t,i){this.M=t,this.j=i,this.O=Math.PI*this.M/180,this.g=Math.PI*this.j/180},t.prototype.setStepOffset=function(t){this.C=t},t.prototype.setWalkSpeed=function(t){this.L.walk.speed=t},t.prototype.setRunSpeed=function(t){this.L.run.speed=t},t.prototype.setBackSpeed=function(t){this.L.walkBack.speed=t},t.prototype.setBackFastSpeed=function(t){this.L.walkBackFast.speed=t},t.prototype.setJumpSpeed=function(t){this.L.idleJump.speed=t,this.L.runJump.speed=t},t.prototype.setLeftSpeed=function(t){this.L.strafeLeft.speed=t},t.prototype.setLeftFastSpeed=function(t){this.L.strafeLeftFast.speed=t},t.prototype.setRightSpeed=function(t){this.L.strafeRight.speed=t},t.prototype.setRightFastSpeed=function(t){this.L.strafeLeftFast.speed=t},t.prototype.setTurnSpeed=function(t){this.L.turnLeft.speed=t*Math.PI/180,this.L.turnRight.speed=t*Math.PI/180},t.prototype.setTurnFastSpeed=function(t){this.L.turnLeftFast.speed=t*Math.PI/180,this.L.turnRightFast.speed=t*Math.PI/180},t.prototype.setGravity=function(t){this.k=t},t.prototype.setAnimationGroups=function(t){null!=this.G&&this.G.exist&&this.G.ag.stop(),this.jt=!0,this.setActionMap(t)},t.prototype.setAnimationRanges=function(t){this.jt=!1,this.setActionMap(t)},t.prototype.setActionMap=function(t){for(var i,s=!1,n=0,e=Object.keys(this.L);n<e.length;n++){var r=e[n],f=this.L[r];f instanceof u&&(f.exist=!1,null!=(i=t[f.id])&&(i instanceof h.AnimationGroup?(f.ag=i,f.name=f.ag.name,f.exist=!0,s=!0,this.yt=!0):i.exist&&(this.yt=!0,f.exist=!0,i instanceof Object?(i.ag&&(f.ag=i.ag,s=!0),i.name&&(f.name=i.name),null!=i.loop&&(f.loop=i.loop),i.rate&&(f.rate=i.rate),i.speed&&(f.speed=i.speed),i.sound&&(f.sound=i.sound)):f.name=i)))}return this.Bt(),this.G=null,s?"ag":"ar"},t.prototype.getActionMap=function(){for(var t=new r,i=0,s=Object.keys(this.L);i<s.length;i++){var h=s[i],n=this.L[h];if(n instanceof u&&n.exist){var e=t[n.id];e.ag=n.ag,e.name=n.name,e.loop=n.loop,e.rate=n.rate,e.speed=n.speed,e.key=n.key,e.sound=n.sound,e.exist=n.exist}}return t},t.prototype.getSettings=function(){var t=new f;return t.faceForward=this.isFaceForward(),t.topDown=1==this.getMode(),t.turningOff=this.isTurningOff(),t.cameraTarget=this.S.clone(),t.cameraElastic=this.R,t.elasticSteps=this.Mt,t.makeInvisble=this.dt,t.gravity=this.k,t.keyboard=this.It,t.maxSlopeLimit=this.j,t.minSlopeLimit=this.M,t.noFirstPerson=this.q,t.stepOffset=this.C,t.sound=this.Jt,t},t.prototype.setSettings=function(t){this.setFaceForward(t.faceForward),this.setMode(t.topDown?1:0),this.setTurningOff(t.turningOff),this.setCameraTarget(t.cameraTarget),this.setCameraElasticity(t.cameraElastic),this.setElasticiSteps(t.elasticSteps),this.makeObstructionInvisible(t.makeInvisble),this.setGravity(t.gravity),this.enableKeyBoard(t.keyboard),this.setSlopeLimit(t.minSlopeLimit,t.maxSlopeLimit),this.setNoFirstPerson(t.noFirstPerson),this.setStepOffset(t.stepOffset),this.setSound(t.sound)},t.prototype._t=function(t,i,s,n){if(this.jt||null!=this.v){if(null!=i)if(this.jt){if(!(i instanceof h.AnimationGroup))return;t.ag=i,t.exist=!0}else{if(null==this.v.getAnimationRange(t.name))return void(t.exist=!1);t.name=i,t.exist=!0}null!=n&&(t.loop=n),null!=s&&(t.rate=s)}},t.prototype.enableBlending=function(t){if(this.jt)for(var i=0,s=Object.keys(this.L);i<s.length;i++){var h=s[i],n=this.L[h];if(n instanceof u&&n.exist)for(var e=0,r=n.ag.targetedAnimations;e<r.length;e++){var f=r[e];f.animation.enableBlending=!0,f.animation.blendingSpeed=t}}else null!==this.v&&this.v.enableBlending(t)},t.prototype.disableBlending=function(){if(this.jt)for(var t=0,i=Object.keys(this.L);t<i.length;t++){var s=i[t],h=this.L[s];if(h instanceof u&&h.exist)for(var n=0,e=h.ag.targetedAnimations;n<e.length;n++){e[n].animation.enableBlending=!1}}},t.prototype.setWalkAnim=function(t,i,s){this._t(this.L.walk,t,i,s)},t.prototype.setRunAnim=function(t,i,s){this._t(this.L.run,t,i,s)},t.prototype.setWalkBackAnim=function(t,i,s){this._t(this.L.walkBack,t,i,s),this.Dt(this.L.walkBackFast,this.L.walkBack)},t.prototype.setWalkBackFastAnim=function(t,i,s){this._t(this.L.walkBackFast,t,i,s)},t.prototype.setSlideBackAnim=function(t,i,s){this._t(this.L.slideBack,t,i,s)},t.prototype.setIdleAnim=function(t,i,s){this._t(this.L.idle,t,i,s)},t.prototype.setTurnRightAnim=function(t,i,s){this._t(this.L.turnRight,t,i,s),this.Dt(this.L.turnRightFast,this.L.turnRight)},t.prototype.setTurnRightFastAnim=function(t,i,s){this._t(this.L.turnRightFast,t,i,s)},t.prototype.setTurnLeftAnim=function(t,i,s){this._t(this.L.turnLeft,t,i,s),this.Dt(this.L.turnLeftFast,this.L.turnLeft)},t.prototype.setTurnLeftFastAnim=function(t,i,s){this._t(this.L.turnLeftFast,t,i,s)},t.prototype.setStrafeRightAnim=function(t,i,s){this._t(this.L.strafeRight,t,i,s),this.Dt(this.L.strafeRightFast,this.L.strafeRight)},t.prototype.setStrafeRightFastAnim=function(t,i,s){this._t(this.L.strafeRightFast,t,i,s)},t.prototype.setStrafeLeftAnim=function(t,i,s){this._t(this.L.strafeLeft,t,i,s),this.Dt(this.L.strafeLeftFast,this.L.strafeLeft)},t.prototype.setStrafeLeftFastAnim=function(t,i,s){this._t(this.L.strafeLeftFast,t,i,s)},t.prototype.setIdleJumpAnim=function(t,i,s){this._t(this.L.idleJump,t,i,s)},t.prototype.setRunJumpAnim=function(t,i,s){this._t(this.L.runJump,t,i,s)},t.prototype.setFallAnim=function(t,i,s){this._t(this.L.fall,t,i,s)},t.prototype.setSound=function(t){if(null!=t){this.Jt=t;var i=Object.keys(this.L);t.loop=!1;for(var s=0,h=i;s<h.length;s++){var n=h[s],e=this.L[n];e instanceof u&&(e.sound=t,e.sound.attachToMesh(this.u))}this.L.idle.sound=null,this.L.fall.sound=null,this.L.slideBack.sound=null}},t.prototype.setWalkKey=function(t){this.L.walk.key=t.toLowerCase()},t.prototype.setWalkBackKey=function(t){this.L.walkBack.key=t.toLowerCase()},t.prototype.setTurnLeftKey=function(t){this.L.turnLeft.key=t.toLowerCase()},t.prototype.setTurnRightKey=function(t){this.L.turnRight.key=t.toLowerCase()},t.prototype.setStrafeLeftKey=function(t){this.L.strafeLeft.key=t.toLowerCase()},t.prototype.setStrafeRightKey=function(t){this.L.strafeRight.key=t.toLowerCase()},t.prototype.setJumpKey=function(t){this.L.idleJump.key=t.toLowerCase()},t.prototype.setCameraElasticity=function(t){this.R=t},t.prototype.setElasticiSteps=function(t){this.Mt=t},t.prototype.makeObstructionInvisible=function(t){this.dt=t},t.prototype.setCameraTarget=function(t){this.S.copyFrom(t)},t.prototype.cameraCollisionChanged=function(){this.ct=this.Ot.checkCollisions},t.prototype.setNoFirstPerson=function(t){this.q=t},t.prototype.xt=function(t){for(var i=0,s=Object.keys(this.L);i<s.length;i++){var h=s[i],n=this.L[h];n instanceof u&&(null!=t?null!=t.getAnimationRange(n.id)&&(n.name=n.id,n.exist=!0,this.yt=!0):n.exist=!1)}this.Bt()},t.prototype.Bt=function(){this.Dt(this.L.walkBackFast,this.L.walkBack),this.Dt(this.L.turnRightFast,this.L.turnRight),this.Dt(this.L.turnLeftFast,this.L.turnLeft),this.Dt(this.L.strafeRightFast,this.L.strafeRight),this.Dt(this.L.strafeLeftFast,this.L.strafeLeft)},t.prototype.Dt=function(t,i){t.exist||i.exist&&(t.exist=!0,t.ag=i.ag,t.name=i.name,t.rate=2*i.rate)},t.prototype.setMode=function(t){this.B=t,this.I=t},t.prototype.getMode=function(){return this.B},t.prototype.setTurningOff=function(t){this.ut=t},t.prototype.isTurningOff=function(){return this.ut},t.prototype.Tt=function(t){var i=t.getWorldMatrix(),s=h.Vector3.FromArray(i.m,0),n=h.Vector3.FromArray(i.m,4),e=h.Vector3.FromArray(i.m,8),u=h.Vector3.Cross(s,n);h.Vector3.Dot(u,e)<0?(this.J=!0,this._=1):(this.J=!1,this._=-1)},t.prototype.setFaceForward=function(t){this.zt=t,this.Et=this.gt.useRightHandedSystem?-1:1,this.J?(this.Gt=t?Math.PI/2:3*Math.PI/2,this.Ht=t?1:-1):(this.Gt=t?3*Math.PI/2:Math.PI/2,this.Ht=t?-1:1)},t.prototype.isFaceForward=function(){return this.zt},t.prototype.checkAGs=function(t){for(var i=0,s=Object.keys(this.L);i<s.length;i++){var h=s[i],n=this.L[h];n instanceof u&&(null!=t[n.name]&&(n.ag=t[n.name],n.exist=!0))}},t.prototype.Kt=function(t,i,s){var n;n=s?this.Nt(t).getChildren((function(t){return t instanceof h.TransformNode}),!1):[t];for(var e=0,u=i;e<u.length;e++)for(var r=0,f=u[e].targetedAnimations;r<f.length;r++){var o=f[r];if(n.indexOf(o.target)>-1)return!0}return!1},t.prototype.Nt=function(t){return null==t.parent?t:this.Nt(t.parent)},t.prototype.start=function(){this.D||(this.D=!0,this.Ct.reset(),this.ht=0,this.rt=.001,this.K=!1,this.Pt(),this.enableKeyBoard(!0),this.gt.registerBeforeRender(this.Ft))},t.prototype.stop=function(){this.D&&(this.D=!1,this.gt.unregisterBeforeRender(this.Ft),this.enableKeyBoard(!1),this.G=null)},t.prototype.pauseAnim=function(){this.T=!0},t.prototype.resumeAnim=function(){this.T=!1},t.prototype.Qt=function(){return h.Vector3.Dot(this.u.forward,this.u.position.subtract(this.Ot.position))<0?1:-1},t.prototype.At=function(){this.H.copyFrom(this.u.position);var t=null,i=this.gt.getEngine().getDeltaTime()/1e3;if(this.Ct.Ut&&!this.V?(this.K=!1,this.rt=0,t=this.Vt(i)):this.anyMovement()||this.V?(this.K=!1,this.rt=0,t=this.Wt(i)):this.V||(t=this.Xt(i)),!this.T&&this.yt&&null!=t&&this.G!==t){if(t.exist){var s=void 0,h=30;if(this.jt)null!=this.G&&this.G.exist&&this.G.ag.stop(),t.ag.start(t.loop,t.rate),h=t.ag.targetedAnimations[0].animation.framePerSecond,s=(t.ag.to-t.ag.from)*h;else{var n=this.v.beginAnimation(t.name,t.loop,t.rate);this.tt=t,s=this.v.getAnimationRange(t.name).to-this.v.getAnimationRange(t.name).from,h=n.getAnimations()[0].animation.framePerSecond}null!=this.G&&null!=this.G.sound&&this.G.sound.stop(),clearInterval(this.Z),null!=t.sound&&(t.sound.play(),this.Z=setInterval((function(){t.sound.play()}),1e3*s/(h*t.rate*2)))}this.G=t}this.Pt()},t.prototype.Vt=function(t){var i=null;i=this.L.runJump,0===this.st&&(this.it=this.u.position.y),this.st=this.st+t;var s,n=0,e=0;if(1==this.B||this.ut||(this.u.rotation.y=this.Gt-this.Ot.alpha),this.X||this.W?(this.X?n=this.L.run.speed*t:this.W&&(n=this.L.walk.speed*t),(s=this.Yt.clone()).y=0,(s=s.normalize()).scaleToRef(n,s),e=this.Zt(this.L.runJump.speed,t),s.y=e):(e=this.Zt(this.L.idleJump.speed,t),s=new h.Vector3(0,e,0),i=this.L.idleJump),this.u.moveWithCollisions(s),e<0)if(this.u.position.y>this.H.y||this.u.position.y===this.H.y&&s.length()>.001)this.$t();else if(this.u.position.y<this.it){var u=this.u.position.subtract(this.H);this.ti(u,s,.001)?i=this.L.fall:this.ii(u)<=this.O&&this.$t()}return i},t.prototype.Zt=function(t,i){return(t-this.k*this.st)*i-.5*this.k*i*i},t.prototype.$t=function(){this.Ct.Ut=!1,this.st=0,this.W=!1,this.X=!1},t.prototype.ti=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},t.prototype.ii=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},t.prototype.Wt=function(t){var i=this.ht*this.k;this.N=i*t+this.k*t*t/2,this.ht=this.ht+t;var s=!1,h=null;if(this.V&&(this.Yt.y=-this.N,s=!0),h=this.si(h,s,t),this.hi(),!this.V){this.W=!1,this.X=!1;var n=void 0,e=0;switch(!0){case this.Ct.ni:n=this._*this.Qt(),e=this.L.strafeLeft.speed*t,this.Ct.ei?(e=this.L.strafeLeftFast.speed*t,h=-this.Ht*n>0?this.L.strafeLeftFast:this.L.strafeRightFast):h=-this.Ht*n>0?this.L.strafeLeft:this.L.strafeRight,this.Yt=this.u.calcMovePOV(n*e,-this.N,0),s=!0;break;case this.Ct.ui:n=-this._*this.Qt(),e=this.L.strafeRight.speed*t,this.Ct.ei?(e=this.L.strafeRightFast.speed*t,h=-this.Ht*n>0?this.L.strafeLeftFast:this.L.strafeRightFast):h=-this.Ht*n>0?this.L.strafeLeft:this.L.strafeRight,this.Yt=this.u.calcMovePOV(n*e,-this.N,0),s=!0;break;case this.Ct.ri||this.ut&&0==this.B:this.Ct.ei?(this.X=!0,e=this.L.run.speed*t,h=this.L.run):(this.W=!0,e=this.L.walk.speed*t,h=this.L.walk),this.Yt=this.u.calcMovePOV(0,-this.N,this.Ht*e),s=!0;break;case this.Ct.fi:e=this.L.walkBack.speed*t,this.Ct.ei?(e=this.L.walkBackFast.speed*t,h=this.L.walkBackFast):h=this.L.walkBack,this.Yt=this.u.calcMovePOV(0,-this.N,-this.Ht*e),s=!0}}if(s&&this.Yt.length()>.001)if(this.u.moveWithCollisions(this.Yt),this.u.position.y>this.H.y){var u=this.u.position.subtract(this.H),r=this.ii(u);r>=this.g?this.C>0?(0==this.F&&this.A.copyFrom(this.H),this.F=this.F+(this.u.position.y-this.H.y),this.F>this.C&&(this.F=0,this.u.position.copyFrom(this.A),this.oi())):(this.u.position.copyFrom(this.H),this.oi()):(this.F=0,r>this.O?(this.U=0,this.V=!1):this.oi())}else if(this.u.position.y<this.H.y){u=this.u.position.subtract(this.H);this.ti(u,this.Yt,.001)?(this.V=!0,this.U++,this.U>this.P&&(h=this.L.fall)):this.ii(u)<=this.O?this.oi():(this.U=0,this.V=!1)}else this.oi();return h},t.prototype.hi=function(){if(1!=this.B)if(this.ut)switch(!0){case this.Ct.ri&&this.Ct.ci:this.u.rotation.y=this.Gt-this.Ot.alpha+this.Et*Math.PI/4;break;case this.Ct.ri&&this.Ct.ai:this.u.rotation.y=this.Gt-this.Ot.alpha-this.Et*Math.PI/4;break;case this.Ct.fi&&this.Ct.ci:this.u.rotation.y=this.Gt-this.Ot.alpha+3*this.Et*Math.PI/4;break;case this.Ct.fi&&this.Ct.ai:this.u.rotation.y=this.Gt-this.Ot.alpha-3*this.Et*Math.PI/4;break;case this.Ct.ri:this.u.rotation.y=this.Gt-this.Ot.alpha;break;case this.Ct.fi:this.u.rotation.y=this.Gt-this.Ot.alpha+Math.PI;break;case this.Ct.ci:this.u.rotation.y=this.Gt-this.Ot.alpha+this.Et*Math.PI/2;break;case this.Ct.ai:this.u.rotation.y=this.Gt-this.Ot.alpha-this.Et*Math.PI/2}else this.u.rotation.y=this.Gt-this.Ot.alpha},t.prototype.si=function(t,i,s){if((!this.ut||0!=this.B)&&!this.Ct.ni&&!this.Ct.ui&&(this.Ct.ai||this.Ct.ci)){var h=this.L.turnLeft.speed*s;if(this.Ct.ei&&(h*=2),1==this.B){this.et||(this.nt=-this.Ht*this.Qt(),this.J&&(this.nt=-this.nt),this.et=!0);var n=this.nt;this.Ct.ai?this.Ct.ri||(this.Ct.fi?n=-this.nt:t=this.nt>0?this.L.turnRight:this.L.turnLeft):this.Ct.ri?n=-this.nt:this.Ct.fi||(n=-this.nt,t=this.nt>0?this.L.turnLeft:this.L.turnRight),this.u.rotation.y=this.u.rotation.y+h*n}else{n=1;this.Ct.ai?(this.Ct.fi&&(n=-1),i||(t=this.L.turnLeft)):(this.Ct.ri&&(n=-1),i||(n=-1,t=this.L.turnRight)),this.Ot.alpha=this.Ot.alpha+this.Et*h*n}}return t},t.prototype.oi=function(){this.ht=0,this.U=0,this.V=!1},t.prototype.Xt=function(t){if(this.K)return this.L.idle;this.W=!1,this.X=!1,this.ht=0;var i=this.L.idle;if(this.U=0,0===t)this.N=5;else{var s=this.rt*this.k;this.N=s*t+this.k*t*t/2,this.rt=this.rt+t}if(this.N<.01)return i;var n=new h.Vector3(0,-this.N,0);if(1==this.B||this.ut||(this.u.rotation.y=this.Gt-this.Ot.alpha),this.u.moveWithCollisions(n),this.u.position.y>this.H.y||this.u.position.y===this.H.y)this.li();else if(this.u.position.y<this.H.y){var e=this.u.position.subtract(this.H);this.ti(e,n,.001)||(this.ii(e)<=this.O?(this.li(),this.u.position.copyFrom(this.H)):(this.vi(),i=this.L.slideBack))}return i},t.prototype.li=function(){this.ft++,this.ft>this.ot&&(this.K=!0,this.rt=0)},t.prototype.vi=function(){this.K=!1,this.ft=0},t.prototype.Pt=function(){0==this.F&&this.u.position.addToRef(this.S,this.Ot.target),this.Ot.radius>this.Ot.lowerRadiusLimit&&(this.R||this.dt)&&this.bi(),this.Ot.radius<=this.Ot.lowerRadiusLimit?this.q||this.lt||(this.u.visibility=0,this.Ot.checkCollisions=!1,this.I=this.B,this.B=0,this.lt=!0):(this.lt=!1,this.B=this.I,this.u.visibility=1,this.Ot.checkCollisions=this.ct)},t.prototype.bi=function(){var t=this;this.Ot.position.subtractToRef(this.Ot.target,this.bt),this.vt.origin=this.Ot.target,this.vt.length=this.bt.length(),this.vt.direction=this.bt.normalize();var i=this.gt.multiPickWithRay(this.vt,(function(i){return i!=t.u}));if(this.dt)if(this.wi=this.kt,i.length>0){this.kt=new Array;for(var s=0,h=i;s<h.length;s++){var n=h[s];(n.pickedMesh.isVisible||this.wi.includes(n.pickedMesh))&&(n.pickedMesh.isVisible=!1,this.kt.push(n.pickedMesh))}for(var e=0,u=this.wi;e<u.length;e++){var r=u[e];this.kt.includes(r)||(r.isVisible=!0)}}else{for(var f=0,o=this.wi;f<o.length;f++){(r=o[f]).isVisible=!0}this.wi.length=0}if(this.R&&i.length>0){if(!(1!=i.length||this.ki(i[0].pickedMesh)||i[0].pickedMesh.checkCollisions&&this.Ot.checkCollisions))return;for(var c=null,a=0;a<i.length;a++){r=i[a].pickedMesh;if(this.ki(r)){c=i[a].pickedPoint;break}if(r.checkCollisions){c=i[a].pickedPoint;break}}if(null==c)return;var l=this.Ot.position.subtract(c),v=l.length();if(this.Ot.checkCollisions){var b=void 0;b=v<=1?l.addInPlace(l.normalizeToNew().scaleInPlace(this.wt)):l.normalize().scaleInPlace(v/this.Mt),this.Ot.position=this.Ot.position.subtract(b)}else{b=void 0;b=v<=1?v+this.wt:v/this.Mt,this.Ot.radius=this.Ot.radius-b}}},t.prototype.ki=function(t){return!!t.isVisible&&(0!=t.visibility&&(null==t.material||0==t.material.alphaMode||0!=t.material.alpha))},t.prototype.anyMovement=function(){return this.Ct.ri||this.Ct.fi||this.Ct.ai||this.Ct.ci||this.Ct.ni||this.Ct.ui},t.prototype.qt=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.L.idleJump.key:this.Ct.Ut=!0;break;case"capslock":this.Ct.ei=!this.Ct.ei;break;case"shift":this.Ct.ei=!0;break;case"up":case"arrowup":case this.L.walk.key:this.Ct.ri=!0;break;case"left":case"arrowleft":case this.L.turnLeft.key:this.Ct.ai=!0;break;case"right":case"arrowright":case this.L.turnRight.key:this.Ct.ci=!0;break;case"down":case"arrowdown":case this.L.walkBack.key:this.Ct.fi=!0;break;case this.L.strafeLeft.key:this.Ct.ni=!0;break;case this.L.strafeRight.key:this.Ct.ui=!0}this.pt=this.anyMovement()}},t.prototype.Rt=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.Ct.ei=!1;break;case"up":case"arrowup":case this.L.walk.key:this.Ct.ri=!1;break;case"left":case"arrowleft":case this.L.turnLeft.key:this.Ct.ai=!1,this.et=!1;break;case"right":case"arrowright":case this.L.turnRight.key:this.Ct.ci=!1,this.et=!1;break;case"down":case"arrowdown":case this.L.walkBack.key:this.Ct.fi=!1;break;case this.L.strafeLeft.key:this.Ct.ni=!1;break;case this.L.strafeRight.key:this.Ct.ui=!1}this.pt=this.anyMovement()}},t.prototype.enableKeyBoard=function(t){this.It=t;var i=this.gt.getEngine().getRenderingCanvas();t?(i.addEventListener("keyup",this.Lt,!1),i.addEventListener("keydown",this.St,!1)):(i.removeEventListener("keyup",this.Lt,!1),i.removeEventListener("keydown",this.St,!1))},t.prototype.walk=function(t){this.Ct.ri=t},t.prototype.walkBack=function(t){this.Ct.fi=t},t.prototype.walkBackFast=function(t){this.Ct.fi=t,this.Ct.ei=t},t.prototype.run=function(t){this.Ct.ri=t,this.Ct.ei=t},t.prototype.turnLeft=function(t){this.Ct.ai=t,t||(this.et=t)},t.prototype.turnLeftFast=function(t){this.Ct.ai=t,t||(this.et=t),this.Ct.ei=t},t.prototype.turnRight=function(t){this.Ct.ci=t,t||(this.et=t)},t.prototype.turnRightFast=function(t){this.Ct.ci=t,t||(this.et=t),this.Ct.ei=t},t.prototype.strafeLeft=function(t){this.Ct.ni=t},t.prototype.strafeLeftFast=function(t){this.Ct.ni=t,this.Ct.ei=t},t.prototype.strafeRight=function(t){this.Ct.ui=t},t.prototype.strafeRightFast=function(t){this.Ct.ui=t,this.Ct.ei=t},t.prototype.jump=function(){this.Ct.Ut=!0},t.prototype.idle=function(){this.Ct.reset()},t.prototype.isAg=function(){return this.jt},t.prototype.di=function(t){var i=this.Mi(t);if(i instanceof h.Mesh&&i.skeleton)return i.skeleton;var s=i.getChildMeshes(!1,(function(t){return!!(t instanceof h.Mesh&&t.skeleton)}));return s.length>0?s[0].skeleton:null},t.prototype.Mi=function(t){return null==t.parent?t:this.Mi(t.parent)},t.prototype.setAvatar=function(t,i){void 0===i&&(i=!1);var s=this.Mi(t);return s instanceof h.Mesh?(this.u=s,this.v=this.di(t),this.jt=this.Kt(t,this.gt.animationGroups,!0),this.L.reset(),this.jt||null==this.v||this.xt(this.v),this.Tt(t),this.setFaceForward(i),!0):(console.error("Cannot move this mesh. The root node of the mesh provided is not a mesh"),!1)},t.prototype.getAvatar=function(){return this.u},t.prototype.setAvatarSkeleton=function(t){this.v=t,null!=this.v&&this.pi(t)?this.jt=!0:this.jt=!1,this.jt||null==this.v||this.xt(this.v)},t.prototype.pi=function(t){var i=this;return t.animations.some((function(t){return i.gt.animationGroups.some((function(i){return i.children.some((function(i){return i.animation==t}))}))}))},t.prototype.getSkeleton=function(){return this.v},t}(),e=function(){function t(){this.ri=!1,this.fi=!1,this.ci=!1,this.ai=!1,this.ui=!1,this.ni=!1,this.Ut=!1,this.ei=!1,this.reset()}return t.prototype.reset=function(){this.ri=!1,this.fi=!1,this.ci=!1,this.ai=!1,this.ui=!1,this.ni=!1,this.Ut=!1,this.ei=!1},t}(),u=function(){function t(t,i,s){void 0===i&&(i=1),this.name="",this.loop=!0,this.rate=1,this.exist=!1,this.id=t,this.speed=i,this.ds=i,this.key=s,this.dk=s}return t.prototype.reset=function(){this.name="",this.speed=this.ds,this.key=this.dk,this.loop=!0,this.rate=1,this.sound=null,this.exist=!1},t}(),r=function(){function t(){this.walk=new u("walk",3,"w"),this.walkBack=new u("walkBack",1.5,"s"),this.walkBackFast=new u("walkBackFast",3,"na"),this.idle=new u("idle",0,"na"),this.idleJump=new u("idleJump",6," "),this.run=new u("run",6,"na"),this.runJump=new u("runJump",6,"na"),this.fall=new u("fall",0,"na"),this.turnLeft=new u("turnLeft",Math.PI/8,"a"),this.turnLeftFast=new u("turnLeftFast",Math.PI/4,"na"),this.turnRight=new u("turnRight",Math.PI/8,"d"),this.turnRightFast=new u("turnRightFast",Math.PI/4,"na"),this.strafeLeft=new u("strafeLeft",1.5,"q"),this.strafeLeftFast=new u("strafeLeftFast",3,"na"),this.strafeRight=new u("strafeRight",1.5,"e"),this.strafeRightFast=new u("strafeRightFast",3,"na"),this.slideBack=new u("slideBack",0,"na")}return t.prototype.reset=function(){for(var t=0,i=Object.keys(this);t<i.length;t++){var s=this[i[t]];s instanceof u&&s.reset()}},t}(),f=function(){this.cameraElastic=!0,this.makeInvisble=!0,this.cameraTarget=h.Vector3.Zero(),this.noFirstPerson=!1,this.topDown=!0,this.turningOff=!0,this.keyboard=!0}}])}));
//# sourceMappingURL=CharacterController.js.map