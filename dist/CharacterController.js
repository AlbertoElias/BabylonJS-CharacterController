!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(window,(function(t){return function(t){var i={};function s(h){if(i[h])return i[h].exports;var n=i[h]={i:h,l:!1,exports:{}};return t[h].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)s.d(h,n,function(i){return t[i]}.bind(null,n));return h},s.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=1)}([function(i,s){i.exports=t},function(t,i,s){"use strict";s.r(i),s.d(i,"CharacterController",(function(){return n}));var h=s(0),n=function(){function t(t,i,s,n,r){var c=this;void 0===r&&(r=!1),this.u=3,this.v=2*this.u,this.k=this.u/2,this.M=2*this.u,this.j=this.u/2,this.g=this.u/2,this.O=Math.PI/4,this.q=9.8,this.S=30,this.B=45,this.C=Math.PI*this.S/180,this.J=Math.PI*this.B/180,this.L=.25,this.R=0,this._=h.Vector3.Zero(),this.A=new e("walk"),this.D=new e("walkBack"),this.F=new e("idle"),this.G=new e("idleJump"),this.H=new e("run"),this.I=new e("runJump"),this.K=new e("fall"),this.N=new e("turnLeft"),this.P=new e("turnRight"),this.T=new e("strafeLeft"),this.U=new e("strafeRight"),this.V=new e("slideBack"),this.W=[this.A,this.D,this.F,this.G,this.H,this.I,this.K,this.N,this.P,this.T,this.U,this.V],this.X="w",this.Y="s",this.Z="a",this.$="d",this.tt="q",this.it="e",this.st=" ",this.ht=!0,this.nt=h.Vector3.Zero(),this.et=!1,this.mode=0,this.ut=0,this.rt=!1,this.ct=-1,this.at=!1,this.ft=!1,this.ot=null,this.lt=h.Vector3.Zero(),this.vt=!1,this.bt=0,this.wt=50,this.kt=0,this.Mt=!1,this.dt=!1,this.pt=!1,this.yt=0,this.jt=0,this.gt=0,this.Ot=1,this.xt=!1,this.qt=!1,this.St=0,this.Bt=0,this.Ct=10,this.Jt=!0,this.Lt=!1,this.Rt=new h.Ray(h.Vector3.Zero(),h.Vector3.One(),1),this._t=h.Vector3.Zero(),this.zt=.5,this.At=0,this.Dt=!1,this.Et=!1,this.Ft=!1,this.Gt=t,this.Ht(t),this.setFaceForward(r),this.It=s,null!=n&&(this.Et=!0,this.setAnimationGroups(n)),(this.Et||null!==this.Kt)&&(this.Ft=!0),this.Et||(this.Kt=t.skeleton),this.Et||null==this.Kt||this.checkAnims(this.Kt),this.Nt=i,this.Jt=this.Nt.checkCollisions,this.Pt=new u,this.Qt=function(){c.Tt()},this.Ut=function(t){c.Vt(t)},this.Wt=function(t){c.Xt(t)}}return t.prototype.setAvatar=function(t){this.Gt=t},t.prototype.setAvatarSkeleton=function(t){this.Kt=t,this.checkAnims(t)},t.prototype.setSlopeLimit=function(t,i){this.S=t,this.B=i,this.C=Math.PI*t/180,this.J=Math.PI*this.B/180},t.prototype.setStepOffset=function(t){this.L=t},t.prototype.setWalkSpeed=function(t){this.u=t},t.prototype.setRunSpeed=function(t){this.v=t},t.prototype.setBackSpeed=function(t){this.k=t},t.prototype.setJumpSpeed=function(t){this.M=t},t.prototype.setLeftSpeed=function(t){this.j=t},t.prototype.setRightSpeed=function(t){this.g=t},t.prototype.setTurnSpeed=function(t){this.O=t*Math.PI/180},t.prototype.setGravity=function(t){this.q=t},t.prototype.setAnimationGroups=function(t){this.Et=!0;for(var i=0,s=this.W;i<s.length;i++){var h=s[i];null!=t[h.Yt]&&(h.Zt=t[h.Yt],h.$t=!0)}},t.prototype.setAnimationRanges=function(t){var i;this.Et=!1;for(var s=0,h=this.W;s<h.length;s++){var n=h[s];null!=(i=t[n.Yt])&&(i instanceof Object?(i.name&&(n.Yt=i.name),i.loop&&(n.ti=i.loop),i.rate&&(n.ti=i.rate)):n.Yt=i,n.$t=!0)}},t.prototype.setAnim=function(t,i,s,h){(this.Et||null!=this.Kt)&&(null!=h&&(t.ti=h),this.Et?(null!=i&&(t.Zt=i,t.$t=!0),null!=s&&t.$t&&(t.ii=s,t.Zt.speedRatio=s)):(null!=i&&(t.Yt=i),null!=s&&(t.ii=s),null!=this.Kt.getAnimationRange(t.Yt)?t.$t=!0:t.$t=!1))},t.prototype.enableBlending=function(t){if(this.Et)for(var i=0,s=this.W;i<s.length;i++){var h=s[i];if(h.$t)for(var n=0,e=h.Zt.targetedAnimations;n<e.length;n++){var u=e[n];u.animation.enableBlending=!0,u.animation.blendingSpeed=t}}else this.Kt.enableBlending(t)},t.prototype.disableBlending=function(){if(this.Et)for(var t=0,i=this.W;t<i.length;t++){var s=i[t];if(s.$t)for(var h=0,n=s.Zt.targetedAnimations;h<n.length;h++){n[h].animation.enableBlending=!1}}},t.prototype.setWalkAnim=function(t,i,s){this.setAnim(this.A,t,i,s)},t.prototype.setRunAnim=function(t,i,s){this.setAnim(this.H,t,i,s)},t.prototype.setWalkBackAnim=function(t,i,s){this.setAnim(this.D,t,i,s)},t.prototype.setSlideBackAnim=function(t,i,s){this.setAnim(this.V,t,i,s)},t.prototype.setIdleAnim=function(t,i,s){this.setAnim(this.F,t,i,s)},t.prototype.setTurnRightAnim=function(t,i,s){this.setAnim(this.P,t,i,s)},t.prototype.setTurnLeftAnim=function(t,i,s){this.setAnim(this.N,t,i,s)},t.prototype.setStrafeRightAnim=function(t,i,s){this.setAnim(this.U,t,i,s)},t.prototype.setStrafeLeftAnim=function(t,i,s){this.setAnim(this.T,t,i,s)},t.prototype.setIdleJumpAnim=function(t,i,s){this.setAnim(this.G,t,i,s)},t.prototype.setRunJumpAnim=function(t,i,s){this.setAnim(this.I,t,i,s)},t.prototype.setFallAnim=function(t,i,s){this.setAnim(this.K,t,i,s)},t.prototype.setWalkKey=function(t){this.X=t.toLowerCase()},t.prototype.setWalkBackKey=function(t){this.Y=t.toLowerCase()},t.prototype.setTurnLeftKey=function(t){this.Z=t.toLowerCase()},t.prototype.setTurnRightKey=function(t){this.$=t.toLowerCase()},t.prototype.setStrafeLeftKey=function(t){this.tt=t.toLowerCase()},t.prototype.setStrafeRightKey=function(t){this.it=t.toLowerCase()},t.prototype.setJumpKey=function(t){this.st=t.toLowerCase()},t.prototype.setCameraElasticity=function(t){this.ht=t},t.prototype.setCameraTarget=function(t){this.nt.copyFrom(t)},t.prototype.cameraCollisionChanged=function(){this.Jt=this.Nt.checkCollisions},t.prototype.setNoFirstPerson=function(t){this.et=t},t.prototype.checkAnims=function(t){for(var i=0,s=this.W;i<s.length;i++){var h=s[i];null!=t?null!=t.getAnimationRange(h.Yt)&&(h.$t=!0):h.$t=!1}},t.prototype.setMode=function(t){this.mode=t,this.ut=t},t.prototype.setTurningOff=function(t){this.qt=t},t.prototype.Ht=function(t){var i=t.getWorldMatrix(),s=h.Vector3.FromFloatArray(i.m,0),n=h.Vector3.FromFloatArray(i.m,4),e=h.Vector3.FromFloatArray(i.m,8),u=h.Vector3.Cross(s,n);h.Vector3.Dot(u,e)<0?(this.rt=!0,this.ct=1):(this.rt=!1,this.ct=-1)},t.prototype.setFaceForward=function(t){this.rt?(this.si=t?Math.PI/2:3*Math.PI/2,this.hi=t?1:-1):(this.si=t?3*Math.PI/2:Math.PI/2,this.hi=t?-1:1)},t.prototype.checkAGs=function(t){for(var i=0,s=this.W;i<s.length;i++){var h=s[i];null!=t[h.Yt]&&(h.Zt=t[h.Yt],h.$t=!0)}},t.prototype.start=function(){this.at||(this.at=!0,this.Pt.reset(),this.gt=0,this.St=.001,this.vt=!1,this.ni(),this.enableKeyBoard(!0),this.It.registerBeforeRender(this.Qt))},t.prototype.stop=function(){this.at&&(this.at=!1,this.It.unregisterBeforeRender(this.Qt),this.enableKeyBoard(!1),this.ot=null)},t.prototype.pauseAnim=function(){this.ft=!0},t.prototype.resumeAnim=function(){this.ft=!1},t.prototype.ei=function(){return h.Vector3.Dot(this.Gt.forward,this.Gt.position.subtract(this.Nt.position))<0?1:-1},t.prototype.Tt=function(){this.lt.copyFrom(this.Gt.position);var t=null,i=this.It.getEngine().getDeltaTime()/1e3;this.Pt.ui&&!this.Mt?(this.vt=!1,this.St=0,t=this.ri(i)):this.anyMovement()||this.Mt?(this.vt=!1,this.St=0,t=this.ci(i)):this.Mt||(t=this.ai(i)),!this.ft&&this.Ft&&null!=t&&this.ot!==t&&(t.$t&&(this.Et?(null!=this.ot&&this.ot.$t&&this.ot.Zt.stop(),t.Zt.play(t.ti)):this.Kt.beginAnimation(t.Yt,t.ti,t.ii)),this.ot=t),this.ni()},t.prototype.ri=function(t){var i=null;i=this.I,0===this.jt&&(this.yt=this.Gt.position.y);var s=(this.M-this.q*this.jt)*t-.5*this.q*t*t;this.jt=this.jt+t;var n,e=0;if(1==this.mode||this.qt||(this.Gt.rotation.y=this.si-this.Nt.alpha),this.pt||this.dt?(this.pt?e=this.v*t:this.dt&&(e=this.u*t),(n=this.fi.clone()).y=0,(n=n.normalize()).scaleToRef(e,n),n.y=s):(n=new h.Vector3(0,s,0),i=this.G),this.Gt.moveWithCollisions(n),s<0)if(this.Gt.position.y>this.lt.y||this.Gt.position.y===this.lt.y&&n.length()>.001)this.oi();else if(this.Gt.position.y<this.yt){var u=this.Gt.position.subtract(this.lt);this.li(u,n,.001)?i=this.K:this.vi(u)<=this.C&&this.oi()}return i},t.prototype.oi=function(){this.Pt.ui=!1,this.jt=0,this.dt=!1,this.pt=!1},t.prototype.li=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},t.prototype.vi=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},t.prototype.ci=function(t){var i=this.gt*this.q;this.bt=i*t+this.q*t*t/2,this.gt=this.gt+t;var s=!1,h=null;if(this.Mt)this.fi.y=-this.bt,s=!0;else{this.dt=!1,this.pt=!1;var n=void 0,e=0;switch(!0){case this.Pt.bi:e=this.j*t,this.Pt.wi&&(e*=2),n=this.ct*this.ei(),this.fi=this.Gt.calcMovePOV(n*e,-this.bt,0),h=-this.hi*n>0?this.T:this.U,s=!0;break;case this.Pt.ki:e=this.g*t,this.Pt.wi&&(e*=2),n=-this.ct*this.ei(),this.fi=this.Gt.calcMovePOV(n*e,-this.bt,0),h=-this.hi*n>0?this.T:this.U,s=!0;break;case this.Pt.A||this.qt&&0==this.mode:this.Pt.wi?(this.pt=!0,e=this.v*t,h=this.H):(this.dt=!0,e=this.u*t,h=this.A),this.fi=this.Gt.calcMovePOV(0,-this.bt,this.hi*e),s=!0;break;case this.Pt.Mi:e=this.k*t,this.Pt.wi&&(e*=2),this.fi=this.Gt.calcMovePOV(0,-this.bt,-this.hi*e),h=this.D,s=!0}}if((!this.qt||0!=this.mode)&&!this.Pt.bi&&!this.Pt.ki&&(this.Pt.N||this.Pt.P)){var u=this.O*t;if(this.Pt.wi&&(u*=2),1==this.mode){this.xt||(this.Ot=-this.hi*this.ei(),this.rt&&(this.Ot=-this.Ot),this.xt=!0);var r=this.Ot;this.Pt.N?this.Pt.A||(this.Pt.Mi?r=-this.Ot:h=this.Ot>0?this.P:this.N):this.Pt.A?r=-this.Ot:this.Pt.Mi||(r=-this.Ot,h=this.Ot>0?this.N:this.P),this.Gt.rotation.y=this.Gt.rotation.y+u*r}else{r=1;this.Pt.N?(this.Pt.Mi&&(r=-1),s||(h=this.N)):(this.Pt.A&&(r=-1),s||(r=-1,h=this.P)),this.Nt.alpha=this.Nt.alpha+u*r}}if(1!=this.mode)if(this.qt)switch(!0){case this.Pt.A&&this.Pt.P:this.Gt.rotation.y=this.si-this.Nt.alpha+Math.PI/4;break;case this.Pt.A&&this.Pt.N:this.Gt.rotation.y=this.si-this.Nt.alpha-Math.PI/4;break;case this.Pt.Mi&&this.Pt.P:this.Gt.rotation.y=this.si-this.Nt.alpha+3*Math.PI/4;break;case this.Pt.Mi&&this.Pt.N:this.Gt.rotation.y=this.si-this.Nt.alpha-3*Math.PI/4;break;case this.Pt.A:this.Gt.rotation.y=this.si-this.Nt.alpha;break;case this.Pt.Mi:this.Gt.rotation.y=this.si-this.Nt.alpha+Math.PI;break;case this.Pt.P:this.Gt.rotation.y=this.si-this.Nt.alpha+Math.PI/2;break;case this.Pt.N:this.Gt.rotation.y=this.si-this.Nt.alpha-Math.PI/2}else this.Gt.rotation.y=this.si-this.Nt.alpha;if(s&&this.fi.length()>.001)if(this.Gt.moveWithCollisions(this.fi),this.Gt.position.y>this.lt.y){var c=this.Gt.position.subtract(this.lt),a=this.vi(c);a>=this.J?this.L>0?(0==this.R&&this._.copyFrom(this.lt),this.R=this.R+(this.Gt.position.y-this.lt.y),this.R>this.L&&(this.R=0,this.Gt.position.copyFrom(this._),this.di())):(this.Gt.position.copyFrom(this.lt),this.di()):(this.R=0,a>this.C?(this.kt=0,this.Mt=!1):this.di())}else if(this.Gt.position.y<this.lt.y){c=this.Gt.position.subtract(this.lt);this.li(c,this.fi,.001)?(this.Mt=!0,this.kt++,this.kt>this.wt&&(h=this.K)):this.vi(c)<=this.C?this.di():(this.kt=0,this.Mt=!1)}else this.di();return h},t.prototype.di=function(){this.gt=0,this.kt=0,this.Mt=!1},t.prototype.ai=function(t){if(this.vt)return this.F;this.dt=!1,this.pt=!1,this.gt=0;var i=this.F;if(this.kt=0,0===t)this.bt=5;else{var s=this.St*this.q;this.bt=s*t+this.q*t*t/2,this.St=this.St+t}if(this.bt<.01)return i;var n=new h.Vector3(0,-this.bt,0);if(1==this.mode||this.qt||(this.Gt.rotation.y=this.si-this.Nt.alpha),this.Gt.moveWithCollisions(n),this.Gt.position.y>this.lt.y||this.Gt.position.y===this.lt.y)this.pi();else if(this.Gt.position.y<this.lt.y){var e=this.Gt.position.subtract(this.lt);this.li(e,n,.001)||(this.vi(e)<=this.C?(this.pi(),this.Gt.position.copyFrom(this.lt)):(this.yi(),i=this.V))}return i},t.prototype.pi=function(){this.Bt++,this.Bt>this.Ct&&(this.vt=!0,this.St=0)},t.prototype.yi=function(){this.vt=!1,this.Bt=0},t.prototype.ni=function(){0==this.R&&this.Gt.position.addToRef(this.nt,this.Nt.target),this.Nt.radius>this.Nt.lowerRadiusLimit&&this.ht&&this.ji(),this.Nt.radius<=this.Nt.lowerRadiusLimit?this.et||this.Lt||(this.Gt.visibility=0,this.Nt.checkCollisions=!1,this.ut=this.mode,this.mode=0,this.Lt=!0):(this.Lt=!1,this.mode=this.ut,this.Gt.visibility=1,this.Nt.checkCollisions=this.Jt)},t.prototype.ji=function(){var t=this;this.Nt.position.subtractToRef(this.Nt.target,this._t),this.Rt.origin=this.Nt.target,this.Rt.length=this._t.length(),this.Rt.direction=this._t.normalize();var i=this.It.pickWithRay(this.Rt,(function(i){return!(i==t.Gt||!i.checkCollisions)}),!0);if(i.hit)if(this.Nt.checkCollisions){var s=this.Nt.target.subtract(i.pickedPoint).normalize().scale(this.zt);i.pickedPoint.addToRef(s,this.Nt.position)}else{var h=i.pickedPoint.subtract(this.Nt.target).length();this.Nt.radius=h-this.zt}},t.prototype.anyMovement=function(){return this.Pt.A||this.Pt.Mi||this.Pt.N||this.Pt.P||this.Pt.bi||this.Pt.ki},t.prototype.Xt=function(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this.st:this.Pt.ui=!0;break;case"capslock":this.Pt.wi=!this.Pt.wi;break;case"shift":this.Pt.wi=!0;break;case"up":case"arrowup":case this.X:this.Pt.A=!0;break;case"left":case"arrowleft":case this.Z:this.Pt.N=!0;break;case"right":case"arrowright":case this.$:this.Pt.P=!0;break;case"down":case"arrowdown":case this.Y:this.Pt.Mi=!0;break;case this.tt:this.Pt.bi=!0;break;case this.it:this.Pt.ki=!0}this.Dt=this.anyMovement()}},t.prototype.Vt=function(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this.Pt.wi=!1;break;case"up":case"arrowup":case this.X:this.Pt.A=!1;break;case"left":case"arrowleft":case this.Z:this.Pt.N=!1,this.xt=!1;break;case"right":case"arrowright":case this.$:this.Pt.P=!1,this.xt=!1;break;case"down":case"arrowdown":case this.Y:this.Pt.Mi=!1;break;case this.tt:this.Pt.bi=!1;break;case this.it:this.Pt.ki=!1}this.Dt=this.anyMovement()}},t.prototype.enableKeyBoard=function(t){var i=this.It.getEngine().getRenderingCanvas();t?(i.addEventListener("keyup",this.Ut,!1),i.addEventListener("keydown",this.Wt,!1)):(i.removeEventListener("keyup",this.Ut,!1),i.removeEventListener("keydown",this.Wt,!1))},t.prototype.walk=function(t){this.Pt.A=t},t.prototype.walkBack=function(t){this.Pt.Mi=t},t.prototype.run=function(t){this.Pt.A=t,this.Pt.wi=t},t.prototype.turnLeft=function(t){this.Pt.N=t,t||(this.xt=t)},t.prototype.turnRight=function(t){this.Pt.P=t,t||(this.xt=t)},t.prototype.strafeLeft=function(t){this.Pt.bi=t},t.prototype.strafeRight=function(t){this.Pt.ki=t},t.prototype.jump=function(){this.Pt.ui=!0},t.prototype.idle=function(){this.Pt.reset()},t}(),e=function(t){this.ti=!0,this.ii=1,this.$t=!1,this.Yt=t},u=function(){function t(){this.A=!1,this.Mi=!1,this.wi=!1,this.P=!1,this.N=!1,this.ki=!1,this.bi=!1,this.ui=!1,this.reset()}return t.prototype.reset=function(){this.A=!1,this.Mi=!1,this.P=!1,this.N=!1,this.ki=!1,this.bi=!1,this.ui=!1,this.wi=!1},t}()}])}));
//# sourceMappingURL=CharacterController.js.map