!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("babylonjs"));else if("function"==typeof define&&define.amd)define(["babylonjs"],i);else{var s="object"==typeof exports?i(require("babylonjs")):i(t.BABYLON);for(var h in s)("object"==typeof exports?exports:t)[h]=s[h]}}(window,(function(t){return function(t){var i={};function s(h){if(i[h])return i[h].exports;var n=i[h]={i:h,l:!1,exports:{}};return t[h].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.h)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)s.d(h,n,function(i){return t[i]}.bind(null,n));return h},s.n=function(t){var i=t&&t.h?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=1)}([function(i,s){i.exports=t},function(t,i,s){"use strict";s.r(i),s.d(i,"CharacterController",(function(){return n})),s.d(i,"AnimData",(function(){return u})),s.d(i,"Action",(function(){return f}));var h=s(0),n=function(){function t(t,i,s,n,o){var e=this;void 0===o&&(o=!1),this.u=3,this.v=2*this.u,this.M=this.u/2,this.j=2*this.u,this.k=this.u/2,this.O=this.u/2,this.g=Math.PI,this.S=9.8,this.A=30,this.q=45,this.B=Math.PI*this.A/180,this.C=Math.PI*this.q/180,this.D=.25,this.J=0,this.L=new h.Vector3(0,0,0),this.R=new u("walk"),this._=new u("walkBack"),this.W=new u("idle"),this.F=new u("idleJump"),this.G=new u("run"),this.H=new u("runJump"),this.I=new u("fall"),this.K=new u("turnLeft"),this.N=new u("turnRight"),this.P=new u("strafeLeft"),this.T=new u("strafeRight"),this.U=new u("slideBack"),this.V=[this.R,this._,this.W,this.F,this.G,this.H,this.I,this.K,this.N,this.P,this.T,this.U],this.X="W",this.Y="S",this.Z="A",this.$="D",this.tt="Q",this.it="E",this.st="32",this.ht=38,this.nt=40,this.ut=37,this.ft=39,this.ot=0,this.et=0,this.rt=32,this.ct=!0,this.lt=new h.Vector3(0,0,0),this.at=!1,this.mode=0,this.vt=0,this.wt=!1,this.dt=-1,this.yt=!1,this.bt=!1,this.pt=null,this.Mt=new h.Vector3(0,0,0),this.jt=!1,this.kt=0,this.Ot=50,this.gt=0,this.St=!1,this.xt=!1,this.At=!1,this.qt=0,this.Bt=0,this.Ct=0,this.Dt=1,this.Jt=0,this.Lt=0,this.Rt=10,this._t=!0,this.Et=!1,this.Qt=new h.Ray(h.Vector3.Zero(),h.Vector3.One(),1),this.Wt=h.Vector3.Zero(),this.zt=.5,this.Ft=0,this.Gt=!1,this.Ht=!1,this.It=!1,this.Kt=t,this.Nt(t),this.setFaceForward(o),this.Pt=s,null!=n&&(this.Ht=!0,this.setAnimationGroups(n)),(this.Ht||null!==this.Tt)&&(this.It=!0),this.Ht||(this.Tt=t.skeleton),this.Ht||null==this.Tt||this.checkAnims(this.Tt),this.Ut=i,this._t=this.Ut.checkCollisions,this.Vt=new f,this.Xt=function(){e.Yt()},this.Zt=function(t){e.$t(t)},this.ti=function(t){e.ii(t)},window.addEventListener("keyup",this.Zt,!1),window.addEventListener("keydown",this.ti,!1)}return t.prototype.setAvatar=function(t){this.Kt=t},t.prototype.setAvatarSkeleton=function(t){this.Tt=t,this.checkAnims(t)},t.prototype.setSlopeLimit=function(t,i){this.A=t,this.q=i,this.B=Math.PI*t/180,this.C=Math.PI*this.q/180},t.prototype.setStepOffset=function(t){this.D=t},t.prototype.setWalkSpeed=function(t){this.u=t},t.prototype.setRunSpeed=function(t){this.v=t},t.prototype.setBackSpeed=function(t){this.M=t},t.prototype.setJumpSpeed=function(t){this.j=t},t.prototype.setLeftSpeed=function(t){this.k=t},t.prototype.setRightSpeed=function(t){this.O=t},t.prototype.setTurnSpeed=function(t){this.g=t*Math.PI/180},t.prototype.setGravity=function(t){this.S=t},t.prototype.setAnimationGroups=function(t){this.Ht=!0;for(var i=0,s=this.V;i<s.length;i++){var h=s[i];null!=t[h.name]&&(h.ag=t[h.name],h.exist=!0)}},t.prototype.setAnimationRanges=function(t){var i;this.Ht=!1;for(var s=0,h=this.V;s<h.length;s++){var n=h[s];null!=(i=t[n.name])&&(i instanceof Object?(i.name&&(n.name=i.name),i.loop&&(n.loop=i.loop),i.rate&&(n.loop=i.rate)):n.name=i,n.exist=!0)}},t.prototype.setAnim=function(t,i,s,h){(this.Ht||null!=this.Tt)&&(null!=h&&(t.loop=h),this.Ht?(null!=i&&(t.ag=i,t.exist=!0),null!=s&&t.exist&&(t.rate=s,t.ag.speedRatio=s)):(null!=i&&(t.name=i),null!=s&&(t.rate=s),null!=this.Tt.getAnimationRange(t.name)?t.exist=!0:t.exist=!1))},t.prototype.enableBlending=function(t){if(this.Ht)for(var i=0,s=this.V;i<s.length;i++){var h=s[i];if(h.exist)for(var n=0,u=h.ag.targetedAnimations;n<u.length;n++){var f=u[n];f.animation.enableBlending=!0,f.animation.blendingSpeed=t}}else this.Tt.enableBlending(t)},t.prototype.disableBlending=function(){if(this.Ht)for(var t=0,i=this.V;t<i.length;t++){var s=i[t];if(s.exist)for(var h=0,n=s.ag.targetedAnimations;h<n.length;h++){n[h].animation.enableBlending=!1}}},t.prototype.setWalkAnim=function(t,i,s){this.setAnim(this.R,t,i,s)},t.prototype.setRunAnim=function(t,i,s){this.setAnim(this.G,t,i,s)},t.prototype.setWalkBackAnim=function(t,i,s){this.setAnim(this._,t,i,s)},t.prototype.setSlideBackAnim=function(t,i,s){this.setAnim(this.U,t,i,s)},t.prototype.setIdleAnim=function(t,i,s){this.setAnim(this.W,t,i,s)},t.prototype.setTurnRightAnim=function(t,i,s){this.setAnim(this.N,t,i,s)},t.prototype.setTurnLeftAnim=function(t,i,s){this.setAnim(this.K,t,i,s)},t.prototype.setStrafeRightAnim=function(t,i,s){this.setAnim(this.T,t,i,s)},t.prototype.setSrafeLeftAnim=function(t,i,s){this.setAnim(this.P,t,i,s)},t.prototype.setIdleJumpAnim=function(t,i,s){this.setAnim(this.F,t,i,s)},t.prototype.setRunJumpAnim=function(t,i,s){this.setAnim(this.H,t,i,s)},t.prototype.setFallAnim=function(t,i,s){this.setAnim(this.I,t,i,s)},t.prototype.setWalkKey=function(t){this.X=t},t.prototype.setWalkBackKey=function(t){this.Y=t},t.prototype.setTurnLeftKey=function(t){this.Z=t},t.prototype.setTurnRightKey=function(t){this.$=t},t.prototype.setStrafeLeftKey=function(t){this.tt=t},t.prototype.setStrafeRightKey=function(t){this.it=t},t.prototype.setJumpKey=function(t){this.st=t},t.prototype.setWalkCode=function(t){this.ht=t},t.prototype.setWalkBackCode=function(t){this.nt=t},t.prototype.setTurnLeftCode=function(t){this.ut=t},t.prototype.setTurnRightCode=function(t){this.ft=t},t.prototype.setStrafeLeftCode=function(t){this.ot=t},t.prototype.setStrafeRightCode=function(t){this.et=t},t.prototype.setJumpCode=function(t){this.rt=t},t.prototype.setCameraElasticity=function(t){this.ct=t},t.prototype.setCameraTarget=function(t){this.lt.copyFrom(t)},t.prototype.cameraCollisionChanged=function(){this._t=this.Ut.checkCollisions},t.prototype.setNoFirstPerson=function(t){this.at=t},t.prototype.checkAnims=function(t){for(var i=0,s=this.V;i<s.length;i++){var h=s[i];null!=t?null!=t.getAnimationRange(h.name)&&(h.exist=!0):h.exist=!1}},t.prototype.setMode=function(t){this.mode=t,this.vt=t},t.prototype.Nt=function(t){var i=t.getWorldMatrix(),s=h.Vector3.FromFloatArray(i.m,0),n=h.Vector3.FromFloatArray(i.m,4),u=h.Vector3.FromFloatArray(i.m,8),f=h.Vector3.Cross(s,n);h.Vector3.Dot(f,u)<0?(this.wt=!0,this.dt=1):(this.wt=!1,this.dt=-1)},t.prototype.setFaceForward=function(t){this.wt?(this.si=t?Math.PI/2:3*Math.PI/2,this.hi=t?1:-1):(this.si=t?3*Math.PI/2:Math.PI/2,this.hi=t?-1:1)},t.prototype.checkAGs=function(t){for(var i=0,s=this.V;i<s.length;i++){var h=s[i];null!=t[h.name]&&(h.ag=t[h.name],h.exist=!0)}},t.prototype.start=function(){this.yt||(this.yt=!0,this.Vt.reset(),this.Ct=0,this.Jt=.001,this.jt=!1,this.ni(),window.addEventListener("keyup",this.Zt,!1),window.addEventListener("keydown",this.ti,!1),this.Pt.registerBeforeRender(this.Xt),this.Pt)},t.prototype.stop=function(){this.yt&&(this.yt=!1,this.Pt.unregisterBeforeRender(this.Xt),window.removeEventListener("keyup",this.Zt,!1),window.removeEventListener("keydown",this.ti,!1),this.pt=null)},t.prototype.pauseAnim=function(){this.bt=!0},t.prototype.resumeAnim=function(){this.bt=!1},t.prototype.ui=function(){return h.Vector3.Dot(this.Kt.forward,this.Kt.position.subtract(this.Ut.position))<0?1:-1},t.prototype.Yt=function(){this.Mt.copyFrom(this.Kt.position);var t=null,i=this.Pt.getEngine().getDeltaTime()/1e3;this.Vt.jump&&!this.St?(this.jt=!1,this.Jt=0,t=this.fi(i)):this.anyMovement()||this.St?(this.jt=!1,this.Jt=0,t=this.oi(i)):this.St||(t=this.ei(i)),!this.bt&&this.It&&null!=t&&this.pt!==t&&(t.exist&&(this.Ht?(null!=this.pt&&this.pt.exist&&this.pt.ag.stop(),t.ag.play(t.loop)):this.Tt.beginAnimation(t.name,t.loop,t.rate)),this.pt=t),this.ni()},t.prototype.fi=function(t){var i=null;i=this.H,0===this.Bt&&(this.qt=this.Kt.position.y);var s=(this.j-this.S*this.Bt)*t-.5*this.S*t*t;this.Bt=this.Bt+t;var n,u=0;if(1!=this.mode&&(this.Kt.rotation.y=this.si-this.Ut.alpha),this.At||this.xt?(this.At?u=this.v*t:this.xt&&(u=this.u*t),(n=this.ri.clone()).y=0,(n=n.normalize()).scaleToRef(u,n),n.y=s):(n=new h.Vector3(0,s,0),i=this.F),this.Kt.moveWithCollisions(n),s<0)if(this.Kt.position.y>this.Mt.y||this.Kt.position.y===this.Mt.y&&n.length()>.001)this.ci();else if(this.Kt.position.y<this.qt){var f=this.Kt.position.subtract(this.Mt);this.li(f,n,.001)?i=this.I:this.ai(f)<=this.B&&this.ci()}return i},t.prototype.ci=function(){this.Vt.jump=!1,this.Bt=0,this.xt=!1,this.At=!1},t.prototype.li=function(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s},t.prototype.ai=function(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))},t.prototype.oi=function(t){var i=this.Ct*this.S;this.kt=i*t+this.S*t*t/2,this.Ct=this.Ct+t;var s=!1,h=null;if(this.St)this.ri.y=-this.kt,s=!0;else if(this.xt=!1,this.At=!1,1!=this.mode&&(this.Kt.rotation.y=this.si-this.Ut.alpha),this.Vt.forward){var n=0;this.Vt.shift?(this.At=!0,n=this.v*t,h=this.G):(this.xt=!0,n=this.u*t,h=this.R),this.ri=this.Kt.calcMovePOV(0,-this.kt,this.hi*n),s=!0}else if(this.Vt.backward)this.ri=this.Kt.calcMovePOV(0,-this.kt,-this.hi*(this.M*t)),h=this._,s=!0;else if(this.Vt.stepLeft){var u=this.dt*this.ui();this.ri=this.Kt.calcMovePOV(u*(this.k*t),-this.kt,0),h=u>0?this.P:this.T,s=!0}else if(this.Vt.stepRight){u=-this.dt*this.ui();this.ri=this.Kt.calcMovePOV(u*(this.O*t),-this.kt,0),h=u>0?this.P:this.T,s=!0}if(!this.Vt.stepLeft&&!this.Vt.stepRight&&(this.Vt.turnLeft||this.Vt.turnRight))if(1==this.mode){this.Vt.name!=this.Vt.prevName&&(this.Vt.prevName=this.Vt.name,this.Dt=-this.hi*this.ui(),this.wt&&(this.Dt=-this.Dt));var f=this.Dt;this.Vt.turnLeft?this.Vt.forward||(this.Vt.backward?f=-this.Dt:h=this.Dt>0?this.N:this.K):this.Vt.forward?f=-this.Dt:this.Vt.backward||(f=-this.Dt,h=this.Dt>0?this.K:this.N),this.Kt.rotation.y=this.Kt.rotation.y+this.g*t*f}else{f=1;this.Vt.turnLeft?(this.Vt.backward&&(f=-1),s||(h=this.K)):(this.Vt.forward&&(f=-1),s||(f=-1,h=this.N)),this.Ut.alpha=this.Ut.alpha+f*this.g*t,this.Kt.rotation.y=this.si-this.Ut.alpha}if(s&&this.ri.length()>.001)if(this.Kt.moveWithCollisions(this.ri),this.Kt.position.y>this.Mt.y){var o=this.Kt.position.subtract(this.Mt),e=this.ai(o);e>=this.C?this.D>0?(0==this.J&&this.L.copyFrom(this.Mt),this.J=this.J+(this.Kt.position.y-this.Mt.y),this.J>this.D&&(this.J=0,this.Kt.position.copyFrom(this.L),this.vi())):(this.Kt.position.copyFrom(this.Mt),this.vi()):(this.J=0,e>this.B?(this.gt=0,this.St=!1):this.vi())}else if(this.Kt.position.y<this.Mt.y){o=this.Kt.position.subtract(this.Mt);this.li(o,this.ri,.001)?(this.St=!0,this.gt++,this.gt>this.Ot&&(h=this.I)):this.ai(o)<=this.B?this.vi():(this.gt=0,this.St=!1)}else this.vi();return h},t.prototype.vi=function(){this.Ct=0,this.gt=0,this.St=!1},t.prototype.ei=function(t){if(this.jt)return this.W;this.xt=!1,this.At=!1,this.Ct=0;var i=this.W;if(this.gt=0,0===t)this.kt=5;else{var s=this.Jt*this.S;this.kt=s*t+this.S*t*t/2,this.Jt=this.Jt+t}if(this.kt<.01)return i;var n=new h.Vector3(0,-this.kt,0);if(1!=this.mode&&(this.Kt.rotation.y=this.si-this.Ut.alpha),this.Kt.moveWithCollisions(n),this.Kt.position.y>this.Mt.y||this.Kt.position.y===this.Mt.y)this.wi();else if(this.Kt.position.y<this.Mt.y){var u=this.Kt.position.subtract(this.Mt);this.li(u,n,.001)||(this.ai(u)<=this.B?(this.wi(),this.Kt.position.copyFrom(this.Mt)):(this.di(),i=this.U))}return i},t.prototype.wi=function(){this.Lt++,this.Lt>this.Rt&&(this.jt=!0,this.Jt=0)},t.prototype.di=function(){this.jt=!1,this.Lt=0},t.prototype.ni=function(){0==this.J&&this.Kt.position.addToRef(this.lt,this.Ut.target),this.Ut.radius>this.Ut.lowerRadiusLimit&&this.ct&&this.yi(),this.Ut.radius<=this.Ut.lowerRadiusLimit?this.at||this.Et||(this.Kt.visibility=0,this.Ut.checkCollisions=!1,this.vt=this.mode,this.mode=0,this.Et=!0):(this.Et=!1,this.mode=this.vt,this.Kt.visibility=1,this.Ut.checkCollisions=this._t)},t.prototype.yi=function(){var t=this;this.Ut.position.subtractToRef(this.Ut.target,this.Wt),this.Qt.origin=this.Ut.target,this.Qt.length=this.Wt.length(),this.Qt.direction=this.Wt.normalize();var i=this.Pt.pickWithRay(this.Qt,(function(i){return!(i==t.Kt||!i.checkCollisions)}),!0);if(i.hit)if(this.Ut.checkCollisions){var s=this.Ut.target.subtract(i.pickedPoint).normalize().scale(this.zt);i.pickedPoint.addToRef(s,this.Ut.position)}else{var h=i.pickedPoint.subtract(this.Ut.target).length();this.Ut.radius=h-this.zt}},t.prototype.anyMovement=function(){return this.Vt.forward||this.Vt.backward||this.Vt.turnLeft||this.Vt.turnRight||this.Vt.stepLeft||this.Vt.stepRight},t.prototype.ii=function(t){var i=t.keyCode,s=String.fromCharCode(i);s===this.st||i===this.rt?this.Vt.jump=!0:16===i?this.Vt.shift=!0:s===this.X||i===this.ht?this.Vt.forward=!0:s===this.Z||i===this.ut?(this.Vt.turnLeft=!0,this.Vt.name="tl"):s===this.$||i===this.ft?(this.Vt.turnRight=!0,this.Vt.name="tr"):s===this.Y||i===this.nt?this.Vt.backward=!0:s===this.tt||i===this.ot?this.Vt.stepLeft=!0:s!==this.it&&i!==this.et||(this.Vt.stepRight=!0),this.Gt=this.anyMovement()},t.prototype.$t=function(t){var i=t.keyCode,s=String.fromCharCode(i);16===i?this.Vt.shift=!1:s===this.X||i===this.ht?this.Vt.forward=!1:s===this.Z||i===this.ut?(this.Vt.turnLeft=!1,this.Vt.name="",this.Vt.prevName=""):s===this.$||i===this.ft?(this.Vt.turnRight=!1,this.Vt.name="",this.Vt.prevName=""):s===this.Y||i===this.nt?this.Vt.backward=!1:s===this.tt||i===this.ot?this.Vt.stepLeft=!1:s!==this.it&&i!==this.et||(this.Vt.stepRight=!1),this.Gt=this.anyMovement()},t.prototype.disableKeyBoard=function(){window.removeEventListener("keyup",this.Zt,!1),window.removeEventListener("keydown",this.ti,!1)},t.prototype.enableKeyBoard=function(){window.addEventListener("keyup",this.Zt,!1),window.addEventListener("keydown",this.ti,!1)},t.prototype.walk=function(t){this.Vt.forward=t},t.prototype.walkBack=function(t){this.Vt.backward=t},t.prototype.run=function(t){this.Vt.forward=t,this.Vt.shift=t},t.prototype.turnLeft=function(t){this.Vt.turnLeft=t,t?this.Vt.name="tl":(this.Vt.name="",this.Vt.prevName="")},t.prototype.turnRight=function(t){this.Vt.turnRight=t,t?this.Vt.name="tr":(this.Vt.name="",this.Vt.prevName="")},t.prototype.strafeLeft=function(t){this.Vt.stepLeft=t},t.prototype.strafeRight=function(t){this.Vt.stepRight=t},t.prototype.jump=function(){this.Vt.jump=!0},t.prototype.idle=function(){this.Vt.reset()},t}(),u=function(t){this.loop=!0,this.rate=1,this.exist=!1,this.name=t},f=function(){function t(){this.prevName="",this.reset()}return t.prototype.reset=function(){this.forward=!1,this.backward=!1,this.turnRight=!1,this.turnLeft=!1,this.stepRight=!1,this.stepLeft=!1,this.jump=!1,this.shift=!1},t}()}])}));
//# sourceMappingURL=CharacterController.js.map